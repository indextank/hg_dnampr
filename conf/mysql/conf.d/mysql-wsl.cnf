# ==========================================
# MySQL WSL 环境优化配置
# ==========================================
# 此配置专门针对 WSL (Windows Subsystem for Linux) 环境优化
# 解决 WSL 环境下数据库连接慢（5-10秒）的问题
#
# 使用方法：
#   在 docker-compose.wsl.yaml 中已配置自动加载此文件
#   或手动设置 MYSQL_ENV_CONFIG_FILE=./conf/mysql/conf.d/mysql-wsl.cnf

[mysqld]
# ==========================================
# 关键优化：减少磁盘 I/O
# ==========================================
# WSL 2 的 I/O 性能较差，以下配置可显著提升性能

# 每秒刷新一次日志，而非每次事务都刷新
# 开发环境可接受，显著减少磁盘写入
innodb_flush_log_at_trx_commit = 2

# 禁用二进制日志同步
sync_binlog = 0

# 使用 fsync，WSL 兼容性更好
innodb_flush_method = fsync

# 禁用双写缓冲（开发环境可接受）
innodb_doublewrite = 0

# 降低 I/O 容量设置，减少后台刷新压力
innodb_io_capacity = 200
innodb_io_capacity_max = 400

# ==========================================
# 关键优化：禁用 DNS 相关功能
# ==========================================
# 禁用 DNS 反向解析，这是解决连接延迟的关键配置
skip_name_resolve = 1

# 禁用主机缓存
host_cache_size = 0

# ==========================================
# 连接优化
# ==========================================
# 增加连接错误容忍度
max_connect_errors = 1000000

# 连接超时设置
connect_timeout = 30
wait_timeout = 600
interactive_timeout = 600

# ==========================================
# 内存和缓存优化（适度配置）
# ==========================================
# WSL 环境下适度配置，避免与 Windows 竞争资源
innodb_buffer_pool_size = 512M
innodb_buffer_pool_instances = 1
innodb_log_buffer_size = 32M

# ==========================================
# 性能监控（开发环境精简）
# ==========================================
# 禁用 Performance Schema 以节省资源
performance_schema = OFF

# ==========================================
# SSL/TLS 配置（开发环境）
# ==========================================
# 开发环境禁用 SSL 以减少握手开销
require_secure_transport = OFF
